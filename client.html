<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Dashboard - Conecta+ (FlexStart)</title>
  <meta name="description" content="Dashboard administrativo Conecta+ - FlexStart" />
  <meta name="keywords" content="Conecta+, dashboard, entregas, produtos, FlexStart" />

  <!-- Favicons (use os seus) -->
  <link href="assets/img/favicon.png" rel="icon" />
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files (do template FlexStart) -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />
  <link href="assets/vendor/aos/aos.css" rel="stylesheet" />
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet" />
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />

  <!-- Main CSS File (FlexStart) -->
  <link href="assets/css/main.css" rel="stylesheet" />

  <!-- Chart.js (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body { font-family: "Poppins", sans-serif; background: #f6f8fb; }
    .sidebar { width: 250px; min-height: 100vh; background: linear-gradient(180deg,#0d6efd,#6f42c1); color: #fff; position: fixed; }
    .sidebar a { color: #fff; }
    .content { margin-left: 260px; padding: 30px; }
    .card-rounded { border-radius: 12px; box-shadow: 0 6px 18px rgba(33,37,41,.06); }
    .preview-img { width: 100%; max-height: 220px; object-fit: cover; border-radius: 8px; display:none; margin-top:10px; }
    .badge-status { font-size: .8rem; padding:.4rem .6rem; border-radius: 8px; }
    .table-responsive { max-height: 420px; overflow:auto; }
    .small-note { font-size: .85rem; color:#6c757d; }
    /* responsive adjustments */
    @media (max-width: 991px) {
      .sidebar { position: relative; width: 100%; min-height: auto; }
      .content { margin-left: 0; padding: 16px; }
    }
  </style>
</head>

<body>

  <!-- SIDEBAR -->
  <aside class="sidebar d-flex flex-column p-4">
    <div class="mb-4 d-flex align-items-center">
      <img src="assets/img/logo.png" alt="logo" style="height:38px;margin-right:10px">
      <h4 class="m-0">Conecta+</h4>
    </div>

    <nav class="nav flex-column">
      <a class="nav-link mb-2" href="#overview"><i class="bi bi-speedometer2 me-2"></i>Início</a>
      <a class="nav-link mb-2" href="#produtos"><i class="bi bi-box-seam me-2"></i>Meus Produtos</a>
      <a class="nav-link mb-2" href="#entregas"><i class="bi bi-truck me-2"></i>Entregas</a>
      <a class="nav-link mb-2" href="#relatorios"><i class="bi bi-graph-up me-2"></i>Relatórios</a>
      <a class="nav-link mb-2" href="#config"><i class="bi bi-gear me-2"></i>Configurações</a>
      <div class="mt-auto small-note">Logado como: <strong>Loja Exemplo</strong></div>
    </nav>
  </aside>

  <!-- CONTENT -->
  <main class="content">

    <!-- HEADER (Resumo rápido) -->
    <div id="overview" class="mb-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">Dashboard Conecta+ — Área do Cliente</h2>
        <div>
          <button class="btn btn-outline-secondary btn-sm me-2" onclick="toggleTheme()">Alternar tema</button>
          <button class="btn btn-primary btn-sm">Novo anúncio</button>
        </div>
      </div>

      <div class="row g-3">
        <div class="col-lg-3">
          <div class="card card-rounded p-3">
            <div class="d-flex justify-content-between">
              <div>
                <small class="small-note">Produtos cadastrados</small>
                <h4 id="totalProdutos">0</h4>
              </div>
              <i class="bi bi-box-seam fs-2 text-primary"></i>
            </div>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="card card-rounded p-3">
            <div class="d-flex justify-content-between">
              <div>
                <small class="small-note">Entregas (mês)</small>
                <h4 id="totalEntregasMes">0</h4>
              </div>
              <i class="bi bi-truck fs-2 text-success"></i>
            </div>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="card card-rounded p-3">
            <div class="d-flex justify-content-between">
              <div>
                <small class="small-note">Atrasadas</small>
                <h4 id="entregasAtrasadas">0</h4>
              </div>
              <i class="bi bi-exclamation-triangle fs-2 text-danger"></i>
            </div>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="card card-rounded p-3">
            <div class="d-flex justify-content-between">
              <div>
                <small class="small-note">Plataforma com melhor engajamento</small>
                <h5 id="topPlataforma">-</h5>
              </div>
              <i class="bi bi-graph-up-arrow fs-2 text-warning"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PRODUTOS -->
    <section id="produtos" class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Meus Produtos</h4>
        <div class="small-note">Adicione produtos, marque queima de estoque, seleção de plataformas e gere descrição com IA.</div>
      </div>

      <div class="row g-4">
        <!-- Formulário -->
        <div class="col-lg-5">
          <div class="card card-rounded p-3">
            <h5>Cadastro / Editar Produto</h5>
            <form id="formProduto">
              <div class="mb-3">
                <label class="form-label">Imagem do produto</label>
                <input class="form-control" type="file" id="imgProduto" accept="image/*">
                <img id="previewImg" class="preview-img" alt="Prévia do produto">
              </div>

              <div class="mb-2">
                <label class="form-label">Nome</label>
                <input id="nomeProduto" class="form-control" placeholder="Nome do produto">
              </div>

              <div class="mb-2">
                <label class="form-label">Categoria</label>
                <select id="categoriaProduto" class="form-select">
                  <option value="">Selecione</option>
                  <option>Alimentos</option>
                  <option>Cosméticos</option>
                  <option>Higiene</option>
                  <option>Medicamentos Naturais</option>
                  <option>Outros</option>
                </select>
              </div>

              <div class="row g-2">
                <div class="col-6">
                  <label class="form-label">Preço (R$)</label>
                  <input id="precoProduto" class="form-control" type="number" step="0.01" min="0">
                </div>
                <div class="col-6">
                  <label class="form-label">Qtd. Estoque</label>
                  <input id="qtdProduto" class="form-control" type="number" min="0" value="1">
                </div>
              </div>

              <div class="mb-2 mt-2">
                <label class="form-label">Plataformas de divulgação</label>
                <div class="d-flex flex-wrap gap-2">
                  <label class="form-check-label"><input class="form-check-input me-1" type="checkbox" value="TikTok">TikTok</label>
                  <label class="form-check-label"><input class="form-check-input me-1" type="checkbox" value="Instagram">Instagram</label>
                  <label class="form-check-label"><input class="form-check-input me-1" type="checkbox" value="Facebook">Facebook</label>
                  <label class="form-check-label"><input class="form-check-input me-1" type="checkbox" value="Google">Google</label>
                  <label class="form-check-label"><input class="form-check-input me-1" type="checkbox" value="YouTube">YouTube</label>
                </div>
              </div>

              <div class="mb-2 checkboxes">
                <label class="form-check-label d-block"><input class="form-check-input me-1" type="checkbox" id="flagQueima"> Produto em Queima de Estoque (próximo da validade)</label>
                <label class="form-check-label d-block"><input class="form-check-input me-1" type="checkbox" id="flagLancamento"> Lançamento</label>
                <label class="form-check-label d-block"><input class="form-check-input me-1" type="checkbox" id="flagDestaque"> Produto Destaque</label>
              </div>

              <div class="mb-2">
                <label class="form-label">Descrição</label>
                <textarea id="descricaoProduto" class="form-control" rows="3"></textarea>
              </div>

              <div class="mb-2">
                <label class="form-label">Observações</label>
                <textarea id="obsProduto" class="form-control" rows="2" placeholder="Observações livres"></textarea>
              </div>

              <div class="d-flex gap-2">
                <button type="button" id="btnGerar" class="btn btn-primary">Gerar Descrição (IA)</button>
                <button type="submit" class="btn btn-success">Salvar Produto</button>
                <button type="button" id="btnLimpar" class="btn btn-outline-secondary">Limpar</button>
              </div>

              <div id="genLoader" class="mt-2 small-note" style="display:none">Gerando descrição inteligente...</div>
            </form>
          </div>
        </div>

        <!-- Lista de produtos e ações -->
        <div class="col-lg-7">
          <div class="card card-rounded p-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h5 class="mb-0">Lista de Produtos</h5>
              <div>
                <button id="exportProdutos" class="btn btn-sm btn-outline-primary me-2">Exportar CSV</button>
                <button id="duplicarProduto" class="btn btn-sm btn-outline-secondary">Duplicar selecionado</button>
              </div>
            </div>

            <div class="table-responsive">
              <table class="table table-hover align-middle">
                <thead>
                  <tr>
                    <th></th>
                    <th>Nome</th>
                    <th>Categoria</th>
                    <th>Preço</th>
                    <th>Qtd.</th>
                    <th>Tags</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="tabelaProdutos">
                  <!-- preenchido via JS -->
                </tbody>
              </table>
            </div>

            <div class="mt-3 small-note">Dica: marque "Queima de estoque" para dar urgência nas descrições geradas pela IA.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- ENTREGAS -->
    <section id="entregas" class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Entregas</h4>
        <div class="small-note">Visualize métodos, status, rastreio e indicadores logísticos.</div>
      </div>

      <div class="row g-3">
        <div class="col-lg-8">
          <div class="card card-rounded p-3">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <strong>Histórico de Entregas</strong>
              <div>
                <select id="filtroMetodo" class="form-select form-select-sm">
                  <option value="">Filtrar por método</option>
                  <option value="Motoboy">Motoboy</option>
                  <option value="Transportadora">Transportadora</option>
                  <option value="Retirada">Retirada local</option>
                  <option value="Correios">Envio (Correios)</option>
                </select>
              </div>
            </div>

            <div class="table-responsive">
              <table class="table table-striped align-middle">
                <thead>
                  <tr>
                    <th>Pedido</th>
                    <th>Cliente</th>
                    <th>Produto</th>
                    <th>Método</th>
                    <th>Data compra</th>
                    <th>Estimativa</th>
                    <th>Status</th>
                    <th>Rastreio</th>
                  </tr>
                </thead>
                <tbody id="tabelaEntregas">
                  <!-- preenchido via JS -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Gráficos -->
        <div class="col-lg-4">
          <div class="card card-rounded p-3 mb-3">
            <h6 class="mb-2">Distribuição por método</h6>
            <canvas id="pieMetodo" height="220"></canvas>
          </div>

          <div class="card card-rounded p-3">
            <h6 class="mb-2">Tempo médio de entrega (dias)</h6>
            <canvas id="lineTempo" height="220"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- RELATÓRIOS -->
    <section id="relatorios" class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Relatórios & Insights</h4>
        <div class="small-note">Relatórios gerados automaticamente (simulados).</div>
      </div>

      <div class="row g-3">
        <div class="col-lg-6">
          <div class="card card-rounded p-3">
            <h6 class="mb-3">Produtos mais vendidos (simulado)</h6>
            <ol id="topProdutos" class="mb-0">
              <!-- preenchido via JS -->
            </ol>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="card card-rounded p-3">
            <h6 class="mb-3">Sugestões da IA</h6>
            <div id="sugestoesIA" class="small-note">
              <!-- preenchido via JS -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- RODAPÉ -->
    <footer class="mt-5 small-note">
      © 2025 <strong>Conecta+</strong> • Dashboard baseado no template FlexStart
    </footer>

  </main>

  <!-- SCRIPTS -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script>
    AOS.init();
  </script>

  <script>
    /* ---------------------------
       Dados simulados iniciais
       --------------------------- */
    const produtos = [];
    const entregas = [
      { pedido: 'P-1001', cliente: 'Ana Souza', produto: 'Kit Natural', metodo: 'Motoboy', data: '2025-10-20', estimativa: '2025-10-20', status: 'Entregue', rastreio: 'MB123' , dias:1},
      { pedido: 'P-1002', cliente: 'Carlos Lima', produto: 'Sabonete Artesanal', metodo: 'Transportadora', data: '2025-10-22', estimativa: '2025-10-24', status: 'Em transporte', rastreio: 'TR456', dias:3},
      { pedido: 'P-1003', cliente: 'Beatriz F.', produto: 'Xarope Natural', metodo: 'Correios', data: '2025-10-25', estimativa: '2025-11-01', status: 'Em transporte', rastreio: 'CR789', dias:7},
      { pedido: 'P-1004', cliente: 'Lucas R.', produto: 'Shampoo Vegano', metodo: 'Retirada', data: '2025-10-26', estimativa: '2025-10-26', status: 'Entregue', rastreio: '-', dias:0},
      { pedido: 'P-1005', cliente: 'Mariana S.', produto: 'Creme Facial', metodo: 'Motoboy', data: '2025-10-15', estimativa: '2025-10-16', status: 'Atrasado', rastreio: 'MB999', dias:5}
    ];

    /* ---------------------------
       Utilitários DOM
       --------------------------- */
    const tabelaProdutos = document.getElementById('tabelaProdutos');
    const tabelaEntregas = document.getElementById('tabelaEntregas');
    const totalProdutosEl = document.getElementById('totalProdutos');
    const totalEntregasMesEl = document.getElementById('totalEntregasMes');
    const entregasAtrasadasEl = document.getElementById('entregasAtrasadas');
    const topPlataformaEl = document.getElementById('topPlataforma');

    /* ---------------------------
       Funções de Produtos
       --------------------------- */
    const imgInput = document.getElementById('imgProduto');
    const previewImg = document.getElementById('previewImg');
    imgInput.addEventListener('change', () => {
      const f = imgInput.files[0];
      if (!f) { previewImg.style.display = 'none'; return; }
      const reader = new FileReader();
      reader.onload = e => { previewImg.src = e.target.result; previewImg.style.display = 'block'; };
      reader.readAsDataURL(f);
    });

    document.getElementById('formProduto').addEventListener('submit', (e) => {
      e.preventDefault();
      salvarProduto();
    });

    document.getElementById('btnGerar').addEventListener('click', gerarDescricaoIA);
    document.getElementById('btnLimpar').addEventListener('click', limparForm);
    document.getElementById('exportProdutos').addEventListener('click', exportarCSV);
    document.getElementById('duplicarProduto').addEventListener('click', duplicarSelecionado);

    function salvarProduto() {
      const nome = document.getElementById('nomeProduto').value.trim();
      if (!nome) return alert('Informe um nome para o produto.');
      const produto = {
        id: Date.now(),
        nome,
        categoria: document.getElementById('categoriaProduto').value,
        preco: Number(document.getElementById('precoProduto').value || 0).toFixed(2),
        qtd: Number(document.getElementById('qtdProduto').value || 0),
        queima: document.getElementById('flagQueima').checked,
        lancamento: document.getElementById('flagLancamento').checked,
        destaque: document.getElementById('flagDestaque').checked,
        desc: document.getElementById('descricaoProduto').value,
        obs: document.getElementById('obsProduto').value,
        img: previewImg.src || null,
        plataformas: Array.from(document.querySelectorAll('#formProduto input[type="checkbox"]'))
                        .filter(ch => ch.checked && ch.value).map(ch => ch.value)
      };
      produtos.push(produto);
      atualizarTabelaProdutos();
      limparForm();
      atualizarKPIs();
      alert('Produto salvo com sucesso.');
    }

    function atualizarTabelaProdutos() {
      tabelaProdutos.innerHTML = '';
      produtos.forEach((p, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="radio" name="selProduto" value="${p.id}"></td>
          <td>${p.nome}</td>
          <td>${p.categoria||'-'}</td>
          <td>R$ ${p.preco}</td>
          <td>${p.qtd}</td>
          <td>
            ${p.queima? '<span class="badge bg-danger">Queima</span>':''}
            ${p.lancamento? '<span class="badge bg-info">Lançamento</span>':''}
            ${p.destaque? '<span class="badge bg-warning text-dark">Destaque</span>':''}
          </td>
          <td>
            <button class="btn btn-sm btn-outline-secondary" onclick="editarProduto(${p.id})"><i class="bi bi-pencil"></i></button>
            <button class="btn btn-sm btn-outline-danger" onclick="removerProduto(${p.id})"><i class="bi bi-trash"></i></button>
          </td>`;
        tabelaProdutos.appendChild(tr);
      });
      totalProdutosEl.innerText = produtos.length;
    }

    function editarProduto(id) {
      const p = produtos.find(x=>x.id===id);
      if (!p) return;
      document.getElementById('nomeProduto').value = p.nome;
      document.getElementById('categoriaProduto').value = p.categoria;
      document.getElementById('precoProduto').value = p.preco;
      document.getElementById('qtdProduto').value = p.qtd;
      document.getElementById('flagQueima').checked = p.queima;
      document.getElementById('flagLancamento').checked = p.lancamento;
      document.getElementById('flagDestaque').checked = p.destaque;
      document.getElementById('descricaoProduto').value = p.desc;
      document.getElementById('obsProduto').value = p.obs;
      if (p.img) { previewImg.src = p.img; previewImg.style.display = 'block'; }
      // remove antigo (simples edit workflow: remove then salvar)
      removerProduto(id, false);
    }

    function removerProduto(id, confirmAlert = true) {
      if (confirmAlert && !confirm('Remover produto?')) return;
      const idx = produtos.findIndex(x=>x.id===id);
      if (idx>=0) produtos.splice(idx,1);
      atualizarTabelaProdutos(); atualizarKPIs();
    }

    function limparForm() {
      document.getElementById('formProduto').reset();
      previewImg.style.display = 'none';
      document.getElementById('previewImg')?.removeAttribute('src');
    }

    function gerarDescricaoIA() {
      const loader = document.getElementById('genLoader'); loader.style.display='block';
      // Simulação de chamada para IA: gera um texto com base em flags
      setTimeout(()=> {
        const nome = document.getElementById('nomeProduto').value || 'Produto';
        let texto = `${nome} — Produto de alta qualidade, formulado para oferecer resultado e confiança. Ideal para público que busca qualidade e custo-benefício.`;
        if (document.getElementById('flagQueima').checked) texto += ' Últimas unidades em queima de estoque — aproveite o desconto e garanta já!';
        if (document.getElementById('flagLancamento').checked) texto += ' Lançamento exclusivo, seja um dos primeiros a oferecer esse produto aos seus clientes.';
        if (document.getElementById('flagDestaque').checked) texto += ' Produto em destaque na nossa vitrine.';
        // Sugestões de hashtags
        texto += '\n\nHashtags sugeridas: #promo #oferta #ConectaMais';
        document.getElementById('descricaoProduto').value = texto;
        loader.style.display='none';
      }, 900);
    }

    function exportarCSV() {
      if (!produtos.length) return alert('Sem produtos para exportar.');
      const header = ['Nome','Categoria','Preço','Qtd','Queima','Lançamento','Destaque','Descrição','Observações','Plataformas'];
      const rows = produtos.map(p => [
        p.nome, p.categoria, p.preco, p.qtd, p.queima, p.lancamento, p.destaque, `"${(p.desc||'').replace(/"/g,'""')}"`, `"${(p.obs||'').replace(/"/g,'""')}"`, `"${(p.plataformas||[]).join(';')}"`
      ]);
      const csv = [header, ...rows].map(r=>r.join(',')).join('\n');
      const blob = new Blob([csv],{type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'produtos_conecta.csv'; a.click();
      URL.revokeObjectURL(url);
    }

    function duplicarSelecionado() {
      const sel = document.querySelector('input[name="selProduto"]:checked');
      if (!sel) return alert('Selecione um produto para duplicar.');
      const id = Number(sel.value);
      const p = produtos.find(x=>x.id===id);
      if (!p) return;
      const clone = {...p, id: Date.now(), nome: p.nome + ' (Cópia)'};
      produtos.push(clone);
      atualizarTabelaProdutos();
      atualizarKPIs();
    }

    /* ---------------------------
       Entregas: render + filtros + gráficos
       --------------------------- */
    function renderEntregas(filterMetodo='') {
      tabelaEntregas.innerHTML = '';
      const lista = entregas.filter(e => !filterMetodo || e.metodo === filterMetodo);
      lista.forEach(e => {
        const tr = document.createElement('tr');
        const statusBadge = badgeForStatus(e.status);
        tr.innerHTML = `
          <td>${e.pedido}</td>
          <td>${e.cliente}</td>
          <td>${e.produto}</td>
          <td>${e.metodo}</td>
          <td>${e.data}</td>
          <td>${e.estimativa}</td>
          <td>${statusBadge}</td>
          <td>${e.rastreio}</td>
        `;
        tabelaEntregas.appendChild(tr);
      });
      totalEntregasMesEl.innerText = entregas.length;
      entregasAtrasadasEl.innerText = entregas.filter(x=>x.status.toLowerCase().includes('atrasado')).length;
    }

    function badgeForStatus(status) {
      if (!status) return '';
      const s = status.toLowerCase();
      if (s.includes('entreg')) return '<span class="badge bg-success badge-status">Entregue</span>';
      if (s.includes('atras')) return '<span class="badge bg-danger badge-status">Atrasado</span>';
      if (s.includes('em transporte')) return '<span class="badge bg-warning text-dark badge-status">Em transporte</span>';
      return `<span class="badge bg-secondary badge-status">${status}</span>`;
    }

    document.getElementById('filtroMetodo').addEventListener('change', (e)=>{
      renderEntregas(e.target.value);
      updateCharts(e.target.value);
    });

    /* ---------------------------
       Charts (Chart.js)
       --------------------------- */
    let pieChart, lineChart;
    function initCharts() {
      const ctxPie = document.getElementById('pieMetodo').getContext('2d');
      pieChart = new Chart(ctxPie, {
        type: 'pie',
        data: { labels: [], datasets: [{ data: [], backgroundColor: ['#0d6efd','#6f42c1','#198754','#ffc107'] }] },
        options: { plugins: { legend: { position: 'bottom' } } }
      });

      const ctxLine = document.getElementById('lineTempo').getContext('2d');
      lineChart = new Chart(ctxLine, {
        type: 'line',
        data: { labels: [], datasets: [{ label: 'Dias', data: [], tension: .3, fill: false }] },
        options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
      });

      updateCharts();
    }

    function updateCharts(filterMetodo='') {
      // Pie: % por método
      const methods = {};
      entregas.forEach(e => {
        if (filterMetodo && e.metodo !== filterMetodo) return;
        methods[e.metodo] = (methods[e.metodo] || 0) + 1;
      });
      const labels = Object.keys(methods);
      const data = labels.map(l => methods[l]);
      pieChart.data.labels = labels; pieChart.data.datasets[0].data = data; pieChart.update();

      // Line: tempo médio por pedido (aqui usamos 'dias' dos dados)
      const grouped = {};
      entregas.forEach(e => {
        if (filterMetodo && e.metodo !== filterMetodo) return;
        grouped[e.metodo] = grouped[e.metodo] || [];
        grouped[e.metodo].push(e.dias || 0);
      });
      const lineLabels = Object.keys(grouped);
      const lineData = lineLabels.map(l => {
        const arr = grouped[l];
        return arr.length ? (arr.reduce((a,b)=>a+b,0)/arr.length).toFixed(1) : 0;
      });

      lineChart.data.labels = lineLabels; lineChart.data.datasets[0].data = lineData; lineChart.update();
    }

    /* ---------------------------
       Relatórios & Insights (simulados)
       --------------------------- */
    function atualizarRelatorios() {
      // Top produtos simulados (com base em produtos cadastrados)
      const top = produtos.slice(0,3);
      const ol = document.getElementById('topProdutos'); ol.innerHTML = '';
      if (!top.length) ol.innerHTML = '<li>Nenhum produto cadastrado</li>';
      top.forEach(p => {
        const li = document.createElement('li'); li.innerText = `${p.nome} — ${p.preco ? 'R$ '+p.preco : '-'}`;
        ol.appendChild(li);
      });

      // Sugestões da IA (simuladas)
      const sugest = document.getElementById('sugestoesIA');
      const plataformas = ['TikTok','Instagram','Facebook','Google','YouTube'];
      const rand = plataformas[Math.floor(Math.random()*plataformas.length)];
      sugest.innerHTML = `<p>Recomendação: Aumente foco em <strong>${rand}</strong> esta semana. Teste 3 criativos diferentes e acompanhe CTR e conversões.</p>`;
      topPlataformaEl.innerText = rand;
    }

    /* ---------------------------
       KPIs
       --------------------------- */
    function atualizarKPIs() {
      totalProdutosEl.innerText = produtos.length;
    }

    /* ---------------------------
       Inicialização da página
       --------------------------- */
    function init() {
      atualizarKPIs();
      renderEntregas();
      initCharts();
      updateCharts();
      atualizarRelatorios();
    }

    init();

    /* ---------------------------
       Pequenas funções utilitárias
       --------------------------- */
    function toggleTheme() {
      document.body.classList.toggle('bg-dark');
      document.body.classList.toggle('text-white');
    }

    // Preencher a tabela de entregas inicial
    renderEntregas();

  </script>
</body>

</html>
